<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Agendamentos - Centro Automotivo JJ</title>
  <link rel="stylesheet" href="/bootstrap/css/bootstrap.min.css"> <!-- Adicionado Bootstrap CSS -->
  <link rel="stylesheet" href="/css/modal-fix.css">
  <link rel="stylesheet" href="/fontawesome/css/all.min.css">
  <link rel="stylesheet" href="/css/main-styles.css"> 
  <link rel="stylesheet" href="/css/agendamentos.css">
  <link rel="stylesheet" href="/css/custom.css">
  <link rel="stylesheet" href="/css/style1.css">
  <style>
    /* Correção para padronizar a capitalização dos badges */
    .status-badge {
      text-transform: capitalize;
    }
  </style>


  <link rel="icon" href="favicon.ico" type="image/x-icon">
  <script src="/bootstrap/js/bootstrap.bundle.min.js"></script>
  <script src="/js/sweetalert2.all.min.js"></script>
  <script src="/js/validacao.js"></script>
</head>

<body>
  <div th:replace="~{barra :: barra}"></div>

  <main class="main-content">
    <div class="container">
      <div class="page-header">
        <h2><i class="fas fa-calendar-check"></i> Gerenciamento de Agendamentos</h2>
        <p>Visualize e gerencie os agendamentos de serviços</p>
      </div>

      <div class="stats-container">
        <div class="stat-card">
          <div class="stat-icon">
            <i class="fas fa-clock"></i>
          </div>
          <div class="stat-info">
            <h3 th:text="${agendaPendente}"></h3>
            <p>Agendamentos pendentes</p>
          </div>
        </div>

        <div class="stat-card warning">
          <div class="stat-icon">
            <i class="fas fa-cog"></i>
          </div>
          <div class="stat-info">
            <h3 th:text="${agendaAndamento}"></h3>
            <p>Em andamento</p>
          </div>
        </div>

        <div class="stat-card success">
          <div class="stat-icon">
            <i class="fas fa-check-circle"></i>
          </div>
          <div class="stat-info">
            <h3 th:text="${agendaConcluidoHoje}"></h3>
            <p>Concluídos hoje</p>
          </div>
        </div>
      </div>



      <!-- Formulário de Agendamento -->
      <div class="form-container" id="agendamento-form-container" style="display: none;">
        <h3 id="formTitulo"><i class="fas fa-plus-circle"></i> Novo Agendamento</h3>

        <form method="post" action="/agendamento-api/salvar" id="agendamento-form">
          <div class="form-row">
            <div class="form-col">
              <div class="form-group">
                <label for="nome_cliente">Nome do Cliente</label>
                <div class="d-flex">
                  <div class="input-wrapper flex-grow-1">
                    <i class="fas fa-user input-icon"></i>
                    <input type="text" id="nome-cliente" name="nomeCliente" list="lista-clientes" placeholder="Nome completo do cliente" required>
                    <datalist id="lista-clientes">
                      <!-- Preencher com dados do backend -->
                      <option th:each="cliente : ${clientes}" th:value="${cliente.nome}"></option>
                    </datalist>
                  </div>
                  <button type="button" class="btn btn-outline-primary ms-2" data-bs-toggle="modal" data-bs-target="#cadastrarClienteModal" title="Cadastrar Novo Cliente">
                    <i class="fas fa-plus"></i>
                  </button>
                </div>
              </div>
            </div>

            <div class="form-col">
              <div class="form-group">
                <label for="veiculo">Veículo</label>
                <div class="d-flex">
                  <div class="input-wrapper flex-grow-1">
                    <i class="fas fa-car input-icon"></i>
                    <input type="text" id="veiculo" name="veiculo" list="lista-veiculos" placeholder="Modelo/Placa do veículo">
                    <datalist id="lista-veiculos">
                       <!-- Preencher com dados do backend -->
                    </datalist>
                  </div>
                  <button type="button" class="btn btn-outline-primary ms-2" data-bs-toggle="modal" data-bs-target="#cadastrarVeiculoModal" title="Cadastrar Novo Veículo">
                    <i class="fas fa-plus"></i>
                  </button>
                </div>
              </div>
            </div>

            <div class="form-col">
              <div class="form-group">
                <label for="tipo_servico">Tipo de Serviço</label>
                <div class="input-wrapper">
                  <i class="fas fa-tools input-icon"></i>
                  <select id="nome-servico" name="idServico" required>
                    <option value="">Selecione um serviço</option>
                    <option th:each="serv : ${servicos}" th:value="${serv.idServico}" th:text="${serv.nomeServico}">
                    </option>
                  </select>
                </div>
              </div>
            </div>
          </div>

          <div class="form-row">
            <div class="form-col">
              <div class="form-group">
                <label for="data-previsao">Agendamento para</label>
                <div class="input-wrapper">
                  <i class="fas fa-calendar-alt input-icon"></i>
                  <input type="date" id="data-previsao" name="dataPrevisao">
                </div>
              </div>
            </div>

            <div class="form-col" style="display: none" id="data_conclusao_container">
              <div class="form-group">
                <label for="data-conclusao">Data de Conclusão</label>
                <div class="input-wrapper">
                  <i class="fas fa-calendar-plus input-icon"></i>
                  <input type="date" id="data-conclusao" name="dataConclusao">
                </div>
              </div>
            </div>
          </div>


          <div class="form-row">
            <div class="form-col">
              <div class="form-group">
                <label for="status">Status</label>
                <div class="input-wrapper">
                  <i class="fas fa-info-circle input-icon"></i>
                  <select id="status" name="statusAgendamento" required>
                    <option value="Agendado">Agendado</option>
                    <option value="Confirmado">Confirmado</option>
                    <option value="Em Andamento">Em Andamento</option>
                    <option value="Concluido">Concluído</option>
                    <option value="Cancelado">Cancelado</option>
                  </select>
                </div>
              </div>
            </div>


          </div>

          <div class="form-group">
            <label for="observacao">Observações</label>
            <div class="input-wrapper">
              <i class="fas fa-comment-alt input-icon"></i>
              <textarea id="observacao" name="observacao" rows="3" maxlength="200"
                placeholder="Observações adicionais sobre o agendamento"></textarea>
            </div>
            <div id="observacao-counter" class="text-end text-muted" style="font-size: 0.85em; margin-top: 5px;">
              <small>0/200</small>
            </div>
          </div>

          <div class="form-actions">
            <input type="hidden" name="idAgendamento" id="idAgendamento" readonly>
            <button type="reset" class="btn btn-secondary" id="btn-cancelar-novo-agendamento">
              <i class="fas fa-times"></i> Cancelar
            </button>
            <button type="submit" class="btn" id="salvarAg">
              <i class="fas fa-save"></i> Salvar Agendamento
            </button>
          </div>
        </form>
        <form id="deleteForm" action="/agendamento-api/apagar" method="post" style="display: none;">
          <input type="hidden" name="idAgendamento" id="deleteId">
        </form>
      </div>

      <!-- Tabela de Agendamentos -->
      <div class="table-container" id="lista-agendamentos-container">
        <div class="table-header">
          <h3><i class="fas fa-list"></i> Lista de Agendamentos</h3>
          <button class="btn btn-primary" id="btn-novo-agendamento">
            <i class="fas fa-plus"></i> Novo Agendamento
          </button>
        </div>

        <div class="table-filters">
          <div class="form-row">
            <div class="form-col">
              <div class="form-group">
                <label for="busca">Buscar Agendamento</label>
                <div class="input-wrapper">
                  <!-- <i class="fas fa-search input-icon"></i> -->
                  <input type="text" id="busca" name="busca" placeholder="Digite para buscar...">
                </div>
              </div>
            </div>

            <div class="form-col">
              <div class="form-group">
                <label for="filtro_status">Filtrar por Status</label>
                <div class="input-wrapper">
                  <i class="fas fa-filter input-icon"></i>
                  <select id="filtro_status" name="filtro_status">
                    <option value="">Todos os status</option>
                    <option value="Agendado">Agendado</option>
                    <option value="Confirmado">Confirmado</option>
                    <option value="Em Andamento">Em Andamento</option>
                    <option value="Concluido">Concluído</option>
                    <option value="Cancelado">Cancelado</option>
                  </select>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="table-responsive">
          <table class="appointments-table">
            <thead>
              <tr>
                <th>Cliente</th>
                <th>Tipo de Serviço</th>
                <!-- <th>Data do Agendamento</th> -->
                <th>Previsão</th>
                <th>Conclusão</th>
                <th>Status</th>
                <th>Observação</th>
                <th>Ações</th>
              </tr>
            </thead>
            <tbody>
              <tr th:if="${agendamentos == null or agendamentos.empty}">
                <td colspan="8" style="text-align: center;">Nenhum resultado encontrado</td>
              </tr>
              <tr th:each="ag : ${agendamentos}">
                <td data-label="Cliente" class="ag-cliente" th:text="${ag.nomeCliente}"></td>
                <td data-label="Tipo de Serviço" class="ag-servico" th:attr="data-servico-id=${ag.servico.idServico}">
                  <span class="service-badge" th:if="${ag.servico != null && ag.servico.nomeServico != null}"
                    th:classappend="' ' + ${#strings.replace(ag.servico.nomeServico.toLowerCase(), ' ', '-')}"
                    th:text="${ag.servico.nomeServico}"> </span>
                  <span th:if="${ag.servico == null or ag.servico.nomeServico == null}">
                </td>
                <!-- <td class="ag-cadastro" th:text="${#temporals.format(ag.dataCadastro, 'dd/MM/yyyy')}"
                  th:data-date="${#temporals.format(ag.dataCadastro, 'yyyy-MM-dd')}">
                </td> -->
                <td data-label="Previsão" class="ag-previsao" th:text="${#temporals.format(ag.dataPrevisao, 'dd/MM/yyyy')}"
                  th:data-date="${#temporals.format(ag.dataPrevisao, 'yyyy-MM-dd')}">
                </td>
                <td data-label="Conclusão" class="ag-conclusao">
                  <span th:if="${ag.dataConclusao != null}" th:text="${#temporals.format(ag.dataConclusao, 'dd/MM/yyyy')}" th:data-date="${#temporals.format(ag.dataConclusao, 'yyyy-MM-dd')}"></span>
                  <span th:unless="${ag.dataConclusao != null}">-</span>
                </td>
                <td data-label="Status" class="ag-status">
                  <span class="status-badge"
                    th:classappend="' ' + ${#strings.replace(ag.statusAgendamento.toLowerCase(), ' ', '_')}"
                    th:text="${#strings.replace(ag.statusAgendamento, '_', ' ')}"></span>
                </td>
                <td data-label="Observação" th:text="${ag.observacao}" class="observacao-cell ag-observacao"></td>
                <td class="action-buttons">
                  <button class="btn-icon btn-edit" th:attr="data-id=${ag.idAgendamento}" title="Editar">
                    <i class="fas fa-edit"></i>
                  </button>
                  <button th:if="${usuarioLogado != null and usuarioLogado.acesso == 'admin'}"
				  class="btn-icon btn-delete" th:attr="data-id=${ag.idAgendamento}" title="Excluir">
                    <i class="fas fa-trash"></i>
                  </button>
                  <button class="btn-icon btn-view" th:attr="data-id=${ag.idAgendamento}" title="Visualizar">
                    <i class="fas fa-eye"></i>
                  </button>
                  <button th:if="${!#strings.equalsIgnoreCase(ag.statusAgendamento, 'Concluido') and !#strings.equalsIgnoreCase(ag.statusAgendamento, 'Concluído') and !#strings.equalsIgnoreCase(ag.statusAgendamento, 'Cancelado')}"
                          class="btn-icon btn-concluir" th:attr="data-id=${ag.idAgendamento}" title="Concluir">
                    <i class="fas fa-check"></i>
                  </button>
                </td>
              </tr>
            </tbody>
          </table>
        </div>

        <div class="table-pagination">
          <button class="btn btn-secondary" id="btn-anterior" disabled>
            <i class="fas fa-chevron-left"></i> Anterior
          </button>
          <span class="pagination-info">Página 1 de 1</span>
          <button class="btn btn-secondary" id="btn-proximo" disabled>
            Próximo <i class="fas fa-chevron-right"></i>
          </button>
        </div>
      </div>


    </div>

    <!-- Modal de Visualização (sem alterações) -->
    <div class="bootstrap-iso">
      <div class="modal fade" id="visualizarAgendamentoModal" tabindex="-1"
        aria-labelledby="visualizarAgendamentoModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="visualizarAgendamentoModalLabel">
                <i class="fas fa-eye"></i> Detalhes do Agendamento
              </h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <div class="row">
                <div class="col-md-8">
                  <h4><strong id="modal-cliente-agendamento"></strong></h4>
                  <p class="text-muted">Tipo de Serviço: <span id="modal-servico-agendamento"></span></p>
                </div>
                <div class="col-md-4 text-md-end">
                  <h5>Previsão</h5>
                  <h4 class="text-success fw-bold" id="modal-previsao-agendamento"></h4>
                </div>
              </div>
              <hr>
              <h6><i class="fas fa-align-left me-2"></i>Observações</h6>
              <p id="modal-observacao" style="white-space: pre-wrap;"></p>
              <hr>
              <div class="row">
                <div class="col-sm-6">
                  <p><strong>Status:</strong> <span id="modal-status"></span></p>
                  <p><strong>Conclusão:</strong> <span id="modal-conclusao"></span></p>
                </div>
              </div>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                <i class="fas fa-times"></i> Fechar
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Modal Cadastrar Cliente -->
      <div class="modal fade" id="cadastrarClienteModal" tabindex="-1" aria-labelledby="cadastrarClienteModalLabel" aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="cadastrarClienteModalLabel"><i class="fas fa-user-plus"></i> Novo Cliente</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <form id="form-novo-cliente">
                <div class="mb-3">
                  <label for="novo-cliente-nome" class="form-label">Nome Completo</label>
                  <input type="text" class="form-control" id="novo-cliente-nome" required>
                </div>
                <div class="mb-3">
                  <label for="novo-cliente-telefone" class="form-label">Telefone/Celular</label>
                  <input type="tel" class="form-control" id="novo-cliente-telefone" required>
                </div>
              </form>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
              <button type="button" class="btn btn-primary" id="btn-salvar-novo-cliente">Salvar</button>
            </div>
          </div>
        </div>
      </div>

      <!-- Modal Cadastrar Veículo -->
      <div class="modal fade" id="cadastrarVeiculoModal" tabindex="-1" aria-labelledby="cadastrarVeiculoModalLabel" aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="cadastrarVeiculoModalLabel"><i class="fas fa-car"></i> Novo Veículo</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <form id="form-novo-veiculo">
                <div class="mb-3">
                  <label for="novo-veiculo-modelo" class="form-label">Modelo</label>
                  <input type="text" class="form-control" id="novo-veiculo-modelo" placeholder="Ex: Gol, Civic..." required>
                </div>
                <div class="mb-3">
                  <label for="novo-veiculo-placa" class="form-label">Placa</label>
                  <input type="text" class="form-control" id="novo-veiculo-placa" placeholder="ABC-1234" required>
                </div>
                <div class="mb-3">
                  <label for="novo-veiculo-marca" class="form-label">Marca</label>
                  <input type="text" class="form-control" id="novo-veiculo-marca" placeholder="Ex: VW, Honda...">
                </div>
              </form>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
              <button type="button" class="btn btn-primary" id="btn-salvar-novo-veiculo">Salvar</button>
            </div>
          </div>
        </div>
      </div>

    </div>
  </main>

  <!-- Rodapé -->
  <footer class="footer">
    <div class="container">
      <div class="footer-content">
        <div class="footer-logo">
          <i class="fas fa-car-alt"></i>
          <span class="logo-highlight">Centro Automotivo </span> JJ
        </div>
        <p class="footer-copyright">&copy; 2025 Centro Automotivo JJ. Todos os direitos reservados.</p>
      </div>
    </div>
  </footer>

  <!-- Script para o campo de data de conclusão -->
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      const statusSelect = document.getElementById('status');
      const dataConclusaoContainer = document.getElementById('data_conclusao_container');

      // Verifica o status inicial
      checkStatus();

      // Adiciona evento para verificar quando o status muda
      statusSelect.addEventListener('change', checkStatus);

      function checkStatus() {
        if (statusSelect.value === 'Concluido') {
          dataConclusaoContainer.style.display = 'block';
          document.getElementById('data_conclusao').required = true;
        } else {
          dataConclusaoContainer.style.display = 'none';
          document.getElementById('data_conclusao').required = false;
        }
      }
    });
  </script>
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      // Seleciona o botão "Novo Agendamento"
      const btnNovoAgendamento = document.getElementById('btn-novo-agendamento');

      // Seleciona o container do formulário de novo agendamento
      const formContainer = document.getElementById('agendamento-form-container');

      // Verifica se ambos os elementos existem na página
      if (btnNovoAgendamento && formContainer) {
        // Adiciona um evento de clique ao botão
        btnNovoAgendamento.addEventListener('click', function () {
          // Limpa o ID do agendamento
          document.getElementById('idAgendamento').value = "";
          // Altera o título do formulário
          document.getElementById('formTitulo').innerHTML = '<i class="fas fa-plus"></i> Novo Agendamento';
          // Mostra o container do formulário
          formContainer.style.display = 'block';
          // Scrolla a tela para o container do formulário
          formContainer.scrollIntoView({ behavior: 'smooth', block: 'start' });
        });
      } else {
        if (!btnNovoAgendamento) {
          console.error('Botão com ID "btn-novo-agendamento" não encontrado.');
        }
        if (!formContainer) {
          console.error('Container do formulário com ID "agendamento-form-container" não encontrado.');
        }
      }

      // Adicionar funcionalidade ao botão "Cancelar" do formulário de novo agendamento
      const btnCancelarNovoAgendamento = document.getElementById('btn-cancelar-novo-agendamento');
      const containerListaAgendamentos = document.getElementById('lista-agendamentos-container');


      if (btnCancelarNovoAgendamento && formContainer && containerListaAgendamentos) {
        btnCancelarNovoAgendamento.addEventListener('click', function () {
          // Esconde o formulário de novo agendamento
          formContainer.style.display = 'none';

          // Reseta os campos do formulário
          const formAgendamento = document.getElementById('agendamento-form');
          if (formAgendamento) {
            formAgendamento.reset();
          }

          // Scrolla a tela de volta para a lista de agendamentos
          containerListaAgendamentos.scrollIntoView({ behavior: 'smooth', block: 'start' });
        });
      } else {
        if (!btnCancelarNovoAgendamento) {
          console.error('Botão "Cancelar Novo Agendamento" (btn-cancelar-novo-agendamento) não encontrado.');
        }
        if (!formContainer) {
          console.error('Container do formulário de novo agendamento (agendamento-form-container) não encontrado para o botão Cancelar.');
        }
        if (!containerListaAgendamentos) {
          console.error('Container da lista de agendamentos (lista-agendamentos-container) não encontrado para scroll no Cancelar.');
        }
      }

      //		SCRIPT DO BACK, AQUI BOTA PRA FUNCIONAR EDITAR E APAGAR
      const editButtons = document.querySelectorAll('.btn-edit');

      editButtons.forEach(function (button) {
        button.addEventListener('click', function () {
          // Altera o título do formulário para editar
          document.getElementById('formTitulo').innerHTML = '<i class="fas fa-edit"></i> Editar Agendamento';
          if (formContainer.style.display === 'none' || formContainer.style.display === '') {
            formContainer.style.display = 'block';
            formContainer.scrollIntoView({ behavior: 'smooth', block: 'start' });
          }
          const row = button.closest('tr');

          const id = button.dataset.id;
		  
          const nome = row.querySelector('.ag-cliente').textContent.trim();
          const status = row.querySelector('.ag-status span').textContent.trim();
          const observacao = row.querySelector('.ag-observacao').textContent.trim();
		  const servico = row.querySelector('.ag-servico').dataset.servicoId;
		  
          const previsaoCell = row.querySelector('.ag-previsao');
          const conclusaoCell = row.querySelector('.ag-conclusao');
          const dataPrevisao = previsaoCell ? previsaoCell.dataset.date : '';
          const dataConclusao = conclusaoCell ? conclusaoCell.dataset.date : '';

          document.getElementById('idAgendamento').value = id;
		  document.getElementById('nome-servico').value = servico;
          document.getElementById('nome-cliente').value = nome;
          document.getElementById('status').value = status;
          document.getElementById('data-previsao').value = dataPrevisao;
          document.getElementById('data-conclusao').value = dataConclusao || '';
          document.getElementById('observacao').value = observacao;

        });
      });

      const deleteButtons = document.querySelectorAll('.btn-delete');

      deleteButtons.forEach(function (button) {
        button.addEventListener('click', function (e) {
          e.preventDefault();

          const id = button.dataset.id;

          Swal.fire({
            title: 'Você tem certeza?',
            text: "Esta ação não poderá ser desfeita!",
            icon: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#4CAF50',
            cancelButtonColor: '#6F6F6F',
            confirmButtonText: 'Sim, excluir!',
            cancelButtonText: 'Cancelar'
          }).then((result) => {
            if (result.isConfirmed) {
              document.getElementById('deleteId').value = id;
              document.getElementById('deleteForm').submit();
            }
          });
        });
      });

    });

    // VISUALIZAR DETALHES DO AGENDAMENTO

    const viewButtons = document.querySelectorAll('.btn-view');
    const visualizarModal = new bootstrap.Modal(document.getElementById('visualizarAgendamentoModal'));
    viewButtons.forEach(function (button) {
      button.addEventListener('click', function () {
        const row = button.closest('tr');
        document.getElementById('modal-cliente-agendamento').textContent = row.querySelector('.ag-cliente').textContent.trim();
        document.getElementById('modal-servico-agendamento').textContent = row.querySelector('.ag-servico').textContent.trim() || 'N/A';
        document.getElementById('modal-previsao-agendamento').textContent = row.querySelector('.ag-previsao').textContent.trim() || 'N/A';
        document.getElementById('modal-observacao').textContent = row.querySelector('.ag-observacao').textContent.trim();
        document.getElementById('modal-status').textContent = row.querySelector('.ag-status span').textContent.trim() || 'Não informado';
        document.getElementById('modal-conclusao').textContent = row.querySelector('.ag-conclusao').textContent.trim();

        visualizarModal.show();
      });
    });

    //	ESSE BLOCO VAI VERIFICAR A DATA INSERIDA NO 'AGENDAMENTO PARA' NO FORMULÁRIO
    const inputData = document.getElementById('data-previsao');
    const salva = document.getElementById('salvarAg');

    inputData.addEventListener('change', function () {
      const valor = inputData.value;
      if (!valor) return;

      const partes = valor.split('-');
      const ano = parseInt(partes[0], 10);
      const mes = parseInt(partes[1], 10) - 1; // Mês em JS é de 0 a 11
      const dia = parseInt(partes[2], 10);

      const dataInput = new Date(ano, mes, dia);

      const hoje = new Date();
      hoje.setHours(0, 0, 0, 0);

      if (dataInput.getTime() < hoje.getTime()) {
        salva.disabled = true
      } else {
        salva.disabled = false
      }
    });

    //	LÓGICA A BUSCA DINÂMICA USANDO ABORDAGEM CLIENT-SIDE
    const busca = document.getElementById('busca')
    const tabela = document.querySelector('table');
    const linhas = tabela.querySelectorAll('tbody tr');

    busca.addEventListener('input', function () {
      const termoBusca = busca.value.toLowerCase();

      linhas.forEach(function (linha) {
        const textoLinha = linha.textContent.toLowerCase();

        if (textoLinha.includes(termoBusca)) {
          linha.style.display = '';
        } else {
          linha.style.display = 'none';
        }
      })
    })

    // LÓGICA PARA SETAR DATA DE CONCLUSÃO AUTOMATICAMENTE QUANDO STATUS FOR CONCLUÍDO
    const statusSelect = document.getElementById('status');
    const dataConclusaoInput = document.getElementById('data-conclusao');
    const dataConclusaoGroup = document.querySelector('.form-col[style*="display: none"]');

    if (statusSelect) {
      statusSelect.addEventListener('change', function() {
        if (statusSelect.value === 'Concluido') {
          const hoje = new Date();
          const dataFormatada = hoje.toISOString().split('T')[0];
          if (dataConclusaoInput) dataConclusaoInput.value = dataFormatada;
          if (dataConclusaoGroup) dataConclusaoGroup.style.display = 'block';
        } else {
          if (dataConclusaoInput) dataConclusaoInput.value = '';
          if (dataConclusaoGroup) dataConclusaoGroup.style.display = 'none';
        }
      });
    }
  </script>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const hamburgerMenu = document.getElementById('hamburger-menu');
      const navMenu = document.getElementById('nav-menu');

      if (hamburgerMenu && navMenu) {
        hamburgerMenu.addEventListener('click', function() {
          navMenu.classList.toggle('active');
          hamburgerMenu.classList.toggle('active');
        });

        // Fecha o menu ao clicar em um link
        const navLinks = navMenu.querySelectorAll('.nav-link');
        navLinks.forEach(link => {
          link.addEventListener('click', function() {
            navMenu.classList.remove('active');
            hamburgerMenu.classList.remove('active');
          });
        });

        // Fecha o menu ao clicar fora dele
        document.addEventListener('click', function(event) {
          if (!navMenu.contains(event.target) && !hamburgerMenu.contains(event.target)) {
            navMenu.classList.remove('active');
            hamburgerMenu.classList.remove('active');
          }
        });
      }
    });
  </script>
  <script>
    // LÓGICA PARA CONCLUIR AGENDAMENTO
    document.querySelectorAll('.btn-concluir').forEach(button => {
      button.addEventListener('click', function () {
        const agendamentoId = this.dataset.id;
        
        Swal.fire({
          title: 'Concluir Agendamento?',
          text: "Deseja realmente marcar este agendamento como concluído?",
          icon: 'question',
          showCancelButton: true,
          confirmButtonColor: '#4CAF50',
          cancelButtonColor: '#6F6F6F',
          confirmButtonText: 'Sim, concluir!',
          cancelButtonText: 'Cancelar'
        }).then((result) => {
          if (result.isConfirmed) {
            fetch(`/agendamento-api/concluir/` + agendamentoId, {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json'
              }
            })
            .then(response => {
              if (!response.ok) {
                throw new Error('Falha ao concluir o agendamento.');
              }
              return response.json();
            })
            .then(data => {
              Swal.fire(
                'Concluído!',
                'O agendamento foi marcado como concluído.',
                'success'
              ).then(() => {
                // Atualiza a UI
                const row = this.closest('tr');
                const statusCell = row.querySelector('.ag-status .status-badge');
                const conclusaoCell = row.querySelector('.ag-conclusao span:first-child');

                statusCell.textContent = 'Concluído';
                statusCell.className = 'status-badge concluido';
                
                const today = new Date();
                const formattedDate = String(today.getDate()).padStart(2, '0') + '/' + String(today.getMonth() + 1).padStart(2, '0') + '/' + today.getFullYear();
                conclusaoCell.textContent = formattedDate;

                this.remove(); // Remove o botão de concluir
              });
            })
            .catch(error => {
              console.error('Erro:', error);
              Swal.fire(
                'Erro!',
                'Não foi possível concluir o agendamento.',
                'error'
              );
            });
          }
        });
      });
    });
    // LÓGICA PARA SALVAR NOVO CLIENTE (SIMULAÇÃO FRONT-END)
    document.getElementById('btn-salvar-novo-cliente').addEventListener('click', function() {
        const nome = document.getElementById('novo-cliente-nome').value;
        if(nome) {
            // Aqui entraria a chamada AJAX para salvar no backend
            // Como é simulação, vamos apenas preencher o campo principal e fechar o modal
            document.getElementById('nome-cliente').value = nome;
            
            // Fechar modal
            const modalEl = document.getElementById('cadastrarClienteModal');
            const modal = bootstrap.Modal.getInstance(modalEl);
            modal.hide();
            
            // Limpar form
            document.getElementById('form-novo-cliente').reset();
            
            Swal.fire('Sucesso', 'Cliente cadastrado (Simulação)', 'success');
        } else {
            Swal.fire('Erro', 'Preencha o nome do cliente', 'error');
        }
    });

    // LÓGICA PARA SALVAR NOVO VEÍCULO (SIMULAÇÃO FRONT-END)
    document.getElementById('btn-salvar-novo-veiculo').addEventListener('click', function() {
        const modelo = document.getElementById('novo-veiculo-modelo').value;
        const placa = document.getElementById('novo-veiculo-placa').value;
        
        if(modelo && placa) {
            // Aqui entraria a chamada AJAX para salvar no backend
            const veiculoString = `${modelo} - ${placa}`;
            document.getElementById('veiculo').value = veiculoString;
            
            // Fechar modal
            const modalEl = document.getElementById('cadastrarVeiculoModal');
            const modal = bootstrap.Modal.getInstance(modalEl);
            modal.hide();
            
            // Limpar form
            document.getElementById('form-novo-veiculo').reset();
            
            Swal.fire('Sucesso', 'Veículo cadastrado (Simulação)', 'success');
        } else {
            Swal.fire('Erro', 'Preencha modelo e placa', 'error');
        }
    });
  </script>
  <script>
    // CONTADOR DE CARACTERES PARA OBSERVAÇÃO
    const observacaoInput = document.getElementById('observacao');
    const observacaoCounter = document.getElementById('observacao-counter');
    // const btnSalvarAgendamento = document.getElementById('salvarAg'); // Já declarado anteriormente ou não necessário se maxlength funcionar

    if (observacaoInput && observacaoCounter) {
      observacaoInput.addEventListener('input', function() {
        const currentLength = this.value.length;
        const maxLength = this.getAttribute('maxlength');
        
        observacaoCounter.querySelector('small').textContent = `${currentLength}/${maxLength}`;
        
        if (currentLength >= maxLength) {
          observacaoCounter.classList.remove('text-muted');
          observacaoCounter.classList.add('text-danger');
          observacaoCounter.querySelector('small').textContent = `${currentLength}/${maxLength} - Limite de caracteres atingido!`;
        } else {
          observacaoCounter.classList.add('text-muted');
          observacaoCounter.classList.remove('text-danger');
        }
      });
    }
  </script>
</body>

</html>