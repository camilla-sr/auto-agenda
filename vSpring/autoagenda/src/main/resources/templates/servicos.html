<!DOCTYPE html>
<html lang="pt-BR">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Serviços - Centro Automotivo JJ</title>
	<link rel="stylesheet" href="/fontawesome/css/all.min.css">
	<link rel="icon" href="favicon.ico" type="image/x-icon">
	<link rel="stylesheet" href="/css/style1.css">
	<link rel="stylesheet" href="/css/main-styles.css">
	<script src="/bootstrap/js/bootstrap.bundle.min.js"></script>
	<script src="/js/sweetalert2.all.min.js"></script>
	<script src="/js/validacao.js"></script>
</head>

<body>

	<div th:replace="~{barra :: barra}"></div>

	<main class="main-content">
		<div class="container">

			<div class="page-header">
				<h2><i class="fas fa-tools"></i> Gerenciamento de Serviços</h2>
				<p>Controle e cadastre novos serviços</p>
			</div>

			<div class="form-container" id="formNovoServicoContainer" style="display: none;">
				<h3 id="formTitulo"><i class="fas fa-plus"></i> Cadastrar Novo Serviço</h3>

				<form method="post" action="/servico-api/salvar" id="form-servico">
					<input type="hidden" name="idServico" id="idServico" readonly>
					<div class="form-row">
						<div class="form-col">
							<div class="form-group">
								<label for="nome-servico">Nome do Serviço</label>
								<input type="text" id="nome-servico" name="nomeServico" class="form-input"
									placeholder="Ex: Troca de óleo">
							</div>
						</div>
						<div class="form-col">
							<div class="form-group">
								<label for="descricao-servico">Descrição</label>
								<input type="text" id="descricao-servico" name="descServico" class="form-input"
									placeholder="Ex: Troca de óleo do motor">
							</div>
						</div>
					</div>

					<div class="form-actions">
						<button type="button" id="btn-cancelar-novo-servico" class="btn btn-secondary">
							<i class="fas fa-times"></i> Cancelar
						</button>
						<button type="submit" class="btn">
							<i class="fas fa-save"></i> Salvar Serviço
						</button>
					</div>
				</form>
				<form id="deleteForm" action="servico-api/apagar" method="post" style="display: none;">
					<input type="hidden" name="idServico" id="deleteId">
				</form>

			</div>

			<div class="table-container">
				<div class="table-header">
					<h3><i class="fas fa-clipboard-list"></i> Lista de Serviços</h3>
					<button id="btn-novo-servico" class="btn"><i class="fas fa-plus"></i>Novo Serviço</button>
				</div>

				<div class="table-actions">
					<input type="text" name="busca" id="busca" placeholder="Digite para buscar...">
				</div>
				<table class="table appointments-table">
					<thead>
						<tr>
							<th>Serviço</th>
							<th>Descrição</th>
							<th>Ações</th>
						</tr>
					</thead>
					<tbody>
						<tr th:if="${servicos == null or servicos.empty}">
							<td colspan="3" style="text-align: center;">Nenhum resultado encontrado</td>
						</tr>
						<tr th:each="serv : ${servicos}">
							<td class="nome-servico" th:text="${serv.nomeServico}"></td>
							<td class="desc-servico" th:text="${serv.descServico}"></td>

							<td class="action-buttons">
								<button class="btn-icon btn-edit" th:attr="data-id=${serv.idServico}"
									title="Editar">
									<i class="fas fa-edit"></i>
								</button>
								<button class="btn-icon btn-delete" th:attr="data-id=${serv.idServico}"
									title="Excluir">
									<i class="fas fa-trash"></i>
								</button>
							</td>
						</tr>
					</tbody>
				</table>
			</div>

		</div>
	</main>

	<!-- Rodapé -->
	<footer class="footer">
		<div class="container">
			<div class="footer-content">
				<div class="footer-logo">
					<i class="fas fa-car-alt"></i>
					<span class="logo-highlight">Centro Automotivo </span> JJ
				</div>
				<p>&copy; 2025 Centro Automotivo JJ. Todos os direitos reservados 2025.</p>
			</div>
		</div>
	</footer>
	<script>
		document.addEventListener('DOMContentLoaded', function () {
			const form = document.getElementById('form-servico');
			const formTitulo = document.getElementById('formTitulo');
			const botaoSalvar = form.querySelector('button[type="submit"]');

			// VALIDAÇÃO DE CAMPOS OBRIGATÓRIOS

			const camposObrigatorios = [
				'nome-servico',
				'descricao-servico'
			];

			function verificarCampos() {
				let valido = true;
				camposObrigatorios.forEach(id => {
					const campo = document.getElementById(id);
					if (!campo || !campo.value || campo.value === '') {
						valido = false;
					}
				});
				botaoSalvar.disabled = !valido;
			}

			camposObrigatorios.forEach(id => {
				const campo = document.getElementById(id);
				if (campo) {
					campo.addEventListener('input', verificarCampos);
				}
			});

			const btnNovoServico = document.getElementById('btn-novo-servico');
			const formServicoContainer = document.getElementById('formNovoServicoContainer');
			const btnCancelarNovoServico = document.getElementById('btn-cancelar-novo-servico');

			btnNovoServico.addEventListener('click', () => {
				form.querySelector('#idServico').value = "";
				formTitulo.innerHTML = '<i class="fas fa-plus"></i> Cadastrar Novo Serviço';
				formServicoContainer.style.display = 'block';
				formServicoContainer.scrollIntoView({ behavior: 'smooth' });
			});

			btnCancelarNovoServico.addEventListener('click', () => {
				form.reset();
				formServicoContainer.style.display = 'none';
				verificarCampos();
			});

			verificarCampos();

			// EDITAR

			const editButtons = document.querySelectorAll('.btn-edit');
			editButtons.forEach(function (button) {
				button.addEventListener('click', function () {
					formTitulo.innerHTML = '<i class="fas fa-edit"></i> Editar Serviço';
					if (formServicoContainer.style.display === 'none' || formServicoContainer.style.display === '') {
						formServicoContainer.style.display = 'block';
					}
					const row = button.closest('tr');
					const id = button.dataset.id;
					const nome = row.querySelector('.nome-servico').textContent.trim();
					const descricao = row.querySelector('.desc-servico').textContent.trim();

					document.getElementById('idServico').value = id;
					document.getElementById('nome-servico').value = nome;
					document.getElementById('descricao-servico').value = descricao;

					verificarCampos();
				});
			});

			// EXCLUIR

			const deleteButtons = document.querySelectorAll('.btn-delete');
			deleteButtons.forEach(function (button) {
				button.addEventListener('click', function (e) {
					e.preventDefault();
					const id = button.dataset.id;
					Swal.fire({
						title: 'Você tem certeza?',
						text: "Esta ação não poderá ser desfeita!",
						icon: 'warning',
						showCancelButton: true,
						confirmButtonColor: '#4CAF50',
						cancelButtonColor: '#6F6F6F',
						confirmButtonText: 'Sim, excluir!',
						cancelButtonText: 'Cancelar'
					}).then((result) => {
						if (result.isConfirmed) {
							// Se o usuário confirmar, preenche o ID no formulário de exclusão e envia
							document.getElementById('deleteId').value = id;
							document.getElementById('deleteForm').submit();
						}
					});
				});
			});

			// BUSCA DINÂMICA CLIENT-SIDE 
			
			const busca = document.getElementById('busca');
			const tabela = document.querySelector('table');
			const linhas = tabela.querySelectorAll('tbody tr');

			busca.addEventListener('input', function () {
				const termoBusca = busca.value.toLowerCase();

				linhas.forEach(function (linha) {
					const textoLinha = linha.textContent.toLowerCase();

					if (textoLinha.includes(termoBusca)) {
						linha.style.display = '';
					} else {
						linha.style.display = 'none';
					}
				});
			});
		});
	</script>
</body>

</html>